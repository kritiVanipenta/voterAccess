<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VoterAccess Chatbot</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Layout: left map column, right chat column */
    .main-grid{display:flex;gap:20px;align-items:flex-start;padding:20px}
    .left-panel{width:38%;min-width:280px}
    .right-panel{flex:1}
    .map-section{background:#fff;padding:12px;border:1px solid #e6e6e6;border-radius:6px}
    #map{width:100%;height:420px;border-radius:4px}
    .map-header h1{margin:0 0 6px 0;font-size:1.1rem}
    .map-controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:8px}
    .map-controls input, .map-controls select{flex:1;min-width:120px;padding:6px}
    .results{margin-top:12px}
    #placesList{list-style:none;padding-left:0;margin:0}
    #placesList li{padding:8px 6px;border-bottom:1px solid #f1f1f1}
  </style>
</head>
<body class="chat">
  <header>
    <div class="navigation">
      <div class="ellipse"></div>
      <button class="home-btn" onclick="window.location.href='index.html'"><div class="text-wrapper">Home</div></button>
      <div class="div">VoterAccess</div>
      <div class="line1"></div>
    </div>
  </header>

  
  <main>
    <div class="main-grid">
      <aside class="left-panel">
        <section class="map-section">
          <div class="map-header">
            <h1>Voter Centers Near You</h1>
            <p class="hint" style="margin:0;font-size:0.9rem;color:#666">Allow location access or enter an address to find nearby voting centers.</p>
          </div>

          <div class="map-controls">
            <button id="locateBtn">Use my current location</button>
            <input id="addressInput" placeholder="Enter address (fallback)" style="margin-left:8px" />
            <button id="geocodeBtn">Find</button>
            <div id="status" aria-live="polite" style="width:100%;color:#444;font-size:0.9rem;margin-top:6px"></div>
          </div>

          <div id="map"></div>

          <div class="results">
            <h2 style="font-size:1rem;margin:8px 0">Results</h2>
            <ul id="placesList"></ul>
          </div>
        </section>
      </aside>

      <section class="right-panel">
        <div class="content">
          <div class="group">
          </div>
        </div>
      </section>
    </div>
  </main>

  <!--
    IMPORTANT: Replace `YOUR_API_KEY` with your Google Maps JavaScript API key.
    Enable the Maps JavaScript API and the Places API in Google Cloud Console.
    For production, restrict the API key to your domain.
  -->

<script>
let map, placesService, infoWindow, userMarker;
let markers = [];
let userLatLng = null;

function initMap() {
  const defaultCenter = { lat: 39.8283, lng: -98.5795 }; // USA center

  map = new google.maps.Map(document.getElementById("map"), {
    center: defaultCenter,
    zoom: 4,
    mapTypeControl: false,
    streetViewControl: false,
    fullscreenControl: false
  });

  infoWindow = new google.maps.InfoWindow();
  placesService = new google.maps.places.PlacesService(map);

  document.getElementById("locateBtn").onclick = useMyLocation;
  document.getElementById("geocodeBtn").onclick = geocodeAddress;
}

function useMyLocation() {
  setStatus("Locating…");

  navigator.geolocation.getCurrentPosition(
    pos => {
      const coords = {
        lat: pos.coords.latitude,
        lng: pos.coords.longitude
      };
      handleLocation(coords);
    },
    err => setStatus("Location unavailable. Enter your address instead.")
  );
}

function geocodeAddress() {
  const input = document.getElementById("addressInput").value.trim();
  if (!input) return setStatus("Enter an address first.");

  setStatus("Finding location…");

  new google.maps.Geocoder().geocode({ address: input }, (result, status) => {
    if (status === "OK" && result[0]) {
      const loc = result[0].geometry.location;
      handleLocation({ lat: loc.lat(), lng: loc.lng() });
    } else {
      setStatus("Could not find that address.");
    }
  });
}

function handleLocation(latlng) {
  userLatLng = latlng;

  map.setCenter(latlng);
  map.setZoom(14);

  if (userMarker) userMarker.setMap(null);
  userMarker = new google.maps.Marker({
    map,
    position: latlng,
    title: "You are here",
    icon: {
      path: google.maps.SymbolPath.CIRCLE,
      scale: 8,
      fillColor: "#4285F4",
      fillOpacity: 1,
      strokeWeight: 2
    }
  });

  searchVotingCenters(latlng);
}

function searchVotingCenters(latlng) {
  clearMarkers();
  setStatus("Searching nearby voting centers…");

  placesService.nearbySearch({
    location: latlng,
    radius: 5000, // 5 km (Google Maps default-ish)
    keyword: "voting center"
  }, (results, status) => {
    if (status !== "OK" || !results.length) {
      setStatus("No centers found nearby.");
      return;
    }

    setStatus(`Found ${results.length} locations.`);
    renderResults(results);
  });
}

function renderResults(results) {
  const list = document.getElementById("placesList");
  list.innerHTML = "";

  results.forEach(place => {
    const marker = new google.maps.Marker({
      map,
      position: place.geometry.location,
      title: place.name
    });

    markers.push(marker);

    marker.addListener("click", () => {
      infoWindow.setContent(
        `<strong>${place.name}</strong><br>${place.vicinity || ""}`
      );
      infoWindow.open(map, marker);
    });

    // List item
    const li = document.createElement("li");
    li.innerHTML = `<strong>${place.name}</strong><br>${place.vicinity || ""}`;
    li.style.cursor = "pointer";
    li.onclick = () => {
      map.panTo(place.geometry.location);
      map.setZoom(16);
      infoWindow.setContent(`<strong>${place.name}</strong>`);
      infoWindow.open(map, marker);
    };

    list.appendChild(li);
  });
}

function clearMarkers() {
  markers.forEach(m => m.setMap(null));
  markers = [];
  document.getElementById("placesList").innerHTML = "";
}

function setStatus(msg) {
  document.getElementById("status").textContent = msg;
}
</script>


  <!-- Load Google Maps JS with Places library. Replace YOUR_API_KEY below. -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4WaIpfUDKmQmikCwQSSrWo4syuWiPyhU&libraries=places&callback=initMap"></script>
  <script src="chatbot.js"></script>

</body>
</html>
